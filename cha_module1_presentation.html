<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CHA Module 1: Community Engagement and Empowerment</title>
    
    <!-- CDN Resources with fallback error handling -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" 
            onerror="console.error('Failed to load html2canvas')"></script>
    <script src="https://cdn.jsdelivr.net/npm/pptxgenjs@3.12.0/dist/pptxgen.bundle.js"
            onerror="console.error('Failed to load pptxgenjs')"></script>
    <script src="https://cdn.jsdelivr.net/npm/docx@8.5.0/build/index.js"
            onerror="console.error('Failed to load docx')"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"
            onerror="console.error('Failed to load FileSaver')"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .presentation-container {
            width: 100%;
            max-width: 900px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .toolbar {
            background: #2d3748;
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }

        .toolbar-left, .toolbar-right {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .toolbar button {
            padding: 8px 20px;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .toolbar .edit-mode-btn {
            background: #48bb78;
            color: white;
        }

        .toolbar .edit-mode-btn.active {
            background: #f56565;
        }

        .toolbar .pdf-btn {
            background: #4299e1;
            color: white;
        }

        .toolbar .ppt-btn {
            background: #d97706;
            color: white;
        }

        .toolbar .docx-btn {
            background: #2563eb;
            color: white;
        }

        .toolbar button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .toolbar button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .toolbar-title {
            color: white;
            font-size: 0.9em;
            font-weight: bold;
        }

        .slide-navigation {
            padding: 20px 30px;
            background: #f7fafc;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #e2e8f0;
        }

        .nav-btn {
            padding: 10px 30px;
            background: #c81e56;
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            font-size: 1em;
        }

        .nav-btn:hover:not(:disabled) {
            background: #a01647;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(200, 30, 86, 0.3);
        }

        .nav-btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }

        .slide-indicator {
            font-weight: bold;
            color: #2d3748;
            font-size: 1.1em;
        }

        .slide-viewer {
            padding: 40px;
            min-height: 500px;
            background: white;
        }

        .slide {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .slide.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .slide h1 {
            color: #c81e56;
            margin-bottom: 30px;
            font-size: 2.5em;
            text-align: center;
            line-height: 1.3;
        }

        .slide h2 {
            color: #2d3748;
            margin: 30px 0 20px;
            font-size: 1.8em;
            border-bottom: 3px solid #c81e56;
            padding-bottom: 10px;
        }

        .slide h3 {
            color: #c81e56;
            margin: 20px 0 15px;
            font-size: 1.3em;
        }

        .slide p {
            color: #4a5568;
            line-height: 1.8;
            margin: 15px 0;
            font-size: 1.1em;
        }

        .slide ul, .slide ol {
            margin: 20px 0 20px 30px;
            color: #4a5568;
        }

        .slide li {
            margin: 12px 0;
            line-height: 1.7;
            font-size: 1.05em;
        }

        .highlight-box {
            background: linear-gradient(135deg, #fef5f7 0%, #fee 100%);
            border-left: 5px solid #c81e56;
            padding: 25px;
            margin: 25px 0;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .card {
            background: #f7fafc;
            padding: 25px;
            margin: 20px 0;
            border-radius: 12px;
            border: 2px solid #e2e8f0;
            transition: all 0.3s ease;
        }

        .card:hover {
            box-shadow: 0 8px 16px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }

        .intro-section {
            text-align: center;
            padding: 60px 40px;
        }

        .intro-section h1 {
            font-size: 3em;
            margin-bottom: 20px;
        }

        .intro-section p {
            font-size: 1.3em;
            margin: 15px 0;
        }

        .welcome-text {
            font-size: 1.4em;
            font-weight: 600;
            color: #c81e56;
            margin-top: 40px;
        }

        strong {
            color: #c81e56;
            font-weight: 600;
        }

        [contenteditable="true"] {
            outline: 2px dashed #c81e56;
            outline-offset: 4px;
            padding: 8px;
            border-radius: 4px;
            transition: all 0.3s ease;
        }

        [contenteditable="true"]:focus {
            outline: 2px solid #c81e56;
            background: #fef5f7;
        }

        /* Notification styles */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            padding: 20px 30px;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            z-index: 10000;
            animation: slideIn 0.3s ease;
            display: none;
        }

        .notification.show {
            display: block;
        }

        .notification.success {
            border-left: 5px solid #48bb78;
        }

        .notification.error {
            border-left: 5px solid #f56565;
        }

        @keyframes slideIn {
            from { 
                transform: translateX(400px);
                opacity: 0;
            }
            to { 
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* Loading overlay */
        .loading-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 9999;
            justify-content: center;
            align-items: center;
        }

        .loading-overlay.active {
            display: flex;
        }

        .loading-content {
            background: white;
            padding: 40px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
        }

        .spinner {
            border: 5px solid #f3f3f3;
            border-top: 5px solid #c81e56;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            color: #2d3748;
            font-size: 1.2em;
            font-weight: bold;
        }

        /* Responsive design */
        @media (max-width: 768px) {
            .slide h1 {
                font-size: 2em;
            }

            .slide h2 {
                font-size: 1.5em;
            }

            .slide-viewer {
                padding: 20px;
            }

            .toolbar {
                flex-direction: column;
            }

            .toolbar-left, .toolbar-right {
                width: 100%;
                justify-content: center;
            }
        }

        /* Error message */
        .error-message {
            background: #fee;
            border-left: 5px solid #f56565;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            color: #c53030;
            display: none;
        }

        .error-message.show {
            display: block;
        }
    </style>
</head>
<body>
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-content">
            <div class="spinner"></div>
            <div class="loading-text" id="loadingText">Processing...</div>
        </div>
    </div>

    <!-- Notification -->
    <div class="notification" id="notification"></div>

    <div class="presentation-container">
        <!-- Toolbar -->
        <div class="toolbar">
            <div class="toolbar-left">
                <span class="toolbar-title">CHA Module 1 Training</span>
            </div>
            <div class="toolbar-right">
                <button class="edit-mode-btn" onclick="toggleEditMode()" title="Enable editing">
                    ‚úèÔ∏è Edit Mode
                </button>
                <button class="pdf-btn" onclick="exportToPDF()" title="Export as PDF">
                    üìÑ Export PDF
                </button>
                <button class="ppt-btn" onclick="exportToPPT()" title="Export as PowerPoint">
                    üìä Export PPT
                </button>
                <button class="docx-btn" onclick="exportToDOCX()" title="Export as Word">
                    üìù Export DOCX
                </button>
            </div>
        </div>

        <!-- Error Message -->
        <div class="error-message" id="errorMessage"></div>

        <!-- Slide Navigation -->
        <div class="slide-navigation">
            <button class="nav-btn" onclick="previousSlide()" id="prevBtn">‚Üê Previous</button>
            <span class="slide-indicator">
                <span id="currentSlide">1</span> / <span id="totalSlides">15</span>
            </span>
            <button class="nav-btn" onclick="nextSlide()" id="nextBtn">Next ‚Üí</button>
        </div>

        <!-- Slide Viewer -->
        <div class="slide-viewer" id="slideViewer">
            <!-- Slide 1: Title Slide -->
            <div class="slide active" data-slide="1">
                <div class="intro-section">
                    <h1>üìö MODULE ONE</h1>
                    <h1>Community Engagement and Empowerment</h1>
                    <p style="font-size: 1.5em; margin-top: 40px;">National Community Health Program</p>
                    <p style="font-size: 1.3em;">Community Health Assistant (CHA) Training</p>
                    <p class="welcome-text">Ministry of Health, Liberia</p>
                    <p style="margin-top: 30px; color: #718096;">¬©2025</p>
                </div>
            </div>

            <!-- Slide 2: Introduction -->
            <div class="slide" data-slide="2">
                <h1>üè• Welcome to Module 1</h1>
                <div class="highlight-box">
                    <h3>Module Overview</h3>
                    <p>This module introduces you to the foundational principles of community engagement and empowerment. As a Community Health Assistant, you will learn how to build strong relationships with community members and empower them to take charge of their health.</p>
                </div>
                <h2>Learning Objectives</h2>
                <ul>
                    <li>Understand the role of CHAs in community health</li>
                    <li>Learn effective communication strategies</li>
                    <li>Master community mobilization techniques</li>
                    <li>Develop trust and build partnerships</li>
                    <li>Promote health literacy and empowerment</li>
                </ul>
            </div>

            <!-- Slide 3: Role of CHA -->
            <div class="slide" data-slide="3">
                <h1>‚≠ê The Role of a Community Health Assistant</h1>
                <p>As a CHA, you are the <strong>bridge between the health system and the community</strong>. Your role is multifaceted and crucial for improving health outcomes.</p>
                
                <div class="card">
                    <h3>üè• Primary Responsibilities</h3>
                    <ul>
                        <li><strong>Health Education:</strong> Teach community members about disease prevention and healthy behaviors</li>
                        <li><strong>Service Delivery:</strong> Provide basic health services and referrals</li>
                        <li><strong>Community Mobilization:</strong> Organize and lead community health activities</li>
                        <li><strong>Data Collection:</strong> Monitor and report health indicators</li>
                        <li><strong>Advocacy:</strong> Speak up for community health needs</li>
                    </ul>
                </div>
            </div>

            <!-- Slide 4: Community Entry -->
            <div class="slide" data-slide="4">
                <h1>üö™ Community Entry Process</h1>
                <p>Successfully entering a community requires <strong>respect, cultural sensitivity, and proper protocol</strong>.</p>
                
                <h2>Steps for Community Entry</h2>
                <ol>
                    <li><strong>Research:</strong> Learn about the community's history, culture, and health needs</li>
                    <li><strong>Protocol:</strong> Follow proper channels - meet with community leaders first</li>
                    <li><strong>Introduction:</strong> Clearly explain your role and purpose</li>
                    <li><strong>Listening:</strong> Hear community concerns and priorities</li>
                    <li><strong>Collaboration:</strong> Work with existing structures and leaders</li>
                    <li><strong>Follow-up:</strong> Maintain regular contact and build trust over time</li>
                </ol>
                
                <div class="highlight-box">
                    <h3>üí° Key Principle</h3>
                    <p>Never assume you know what the community needs. <strong>Listen first, act second.</strong></p>
                </div>
            </div>

            <!-- Slide 5: Mapping Community -->
            <div class="slide" data-slide="5">
                <h1>üó∫Ô∏è Community Mapping & Assessment</h1>
                <p>Understanding your community's layout and resources is essential for effective service delivery.</p>
                
                <div class="card">
                    <h3>What to Map</h3>
                    <ul>
                        <li>Households and population distribution</li>
                        <li>Health facilities and traditional healers</li>
                        <li>Water sources and sanitation facilities</li>
                        <li>Schools, churches, and community gathering places</li>
                        <li>High-risk areas (floods, waste sites, etc.)</li>
                        <li>Transportation routes and access points</li>
                    </ul>
                </div>
                
                <div class="highlight-box">
                    <h3>Participatory Mapping</h3>
                    <p>Involve community members in creating maps. This builds ownership and reveals local knowledge you might miss on your own.</p>
                </div>
            </div>

            <!-- Slide 6: Building Trust -->
            <div class="slide" data-slide="6">
                <h1>üè† Building Trust with Communities</h1>
                <p>Trust is the <strong>foundation</strong> of all your work as a CHA. Without trust, community members won't follow health advice or seek services.</p>
                
                <h2>How to Build Trust</h2>
                <div class="card">
                    <h3>1. Be Consistent</h3>
                    <p>Show up regularly and keep your promises. If you say you'll return, return.</p>
                </div>
                
                <div class="card">
                    <h3>2. Respect Confidentiality</h3>
                    <p>Never share personal health information or family matters with others.</p>
                </div>
                
                <div class="card">
                    <h3>3. Live What You Teach</h3>
                    <p>Model healthy behaviors in your own life. Practice what you preach.</p>
                </div>
                
                <div class="card">
                    <h3>4. Admit When You Don't Know</h3>
                    <p>It's okay to say "I don't know, but I'll find out." Honesty builds credibility.</p>
                </div>
            </div>

            <!-- Slide 7: Communication Skills -->
            <div class="slide" data-slide="7">
                <h1>üö∂ Effective Communication Skills</h1>
                <p>Good communication is <strong>more than just talking</strong> - it's about understanding and being understood.</p>
                
                <h2>Key Communication Principles</h2>
                <ul>
                    <li><strong>Use Simple Language:</strong> Avoid medical jargon</li>
                    <li><strong>Listen Actively:</strong> Pay attention to both words and body language</li>
                    <li><strong>Ask Open Questions:</strong> "Tell me about..." instead of "Do you..."</li>
                    <li><strong>Confirm Understanding:</strong> Ask people to explain back in their own words</li>
                    <li><strong>Be Patient:</strong> Give people time to process and respond</li>
                    <li><strong>Show Empathy:</strong> Acknowledge feelings and concerns</li>
                </ul>
                
                <div class="highlight-box">
                    <h3>Cultural Communication</h3>
                    <p>Be aware of cultural norms around eye contact, personal space, and appropriate topics. Adapt your communication style to respect local customs.</p>
                </div>
            </div>

            <!-- Slide 8: Health Education -->
            <div class="slide" data-slide="8">
                <h1>üìö Health Education Methods</h1>
                <p>Teaching health information effectively requires using <strong>multiple methods</strong> that engage different learning styles.</p>
                
                <div class="card">
                    <h3>Teaching Methods</h3>
                    <ul>
                        <li><strong>Demonstrations:</strong> Show, don't just tell (handwashing, proper medication use)</li>
                        <li><strong>Stories & Dramas:</strong> Use narratives people can relate to</li>
                        <li><strong>Visual Aids:</strong> Pictures, posters, and flipcharts for those who can't read</li>
                        <li><strong>Group Discussions:</strong> Let people share experiences and learn from each other</li>
                        <li><strong>Songs & Poems:</strong> Make health messages memorable</li>
                        <li><strong>Home Visits:</strong> Personalized teaching in familiar settings</li>
                    </ul>
                </div>
            </div>

            <!-- Slide 9: Community Mobilization -->
            <div class="slide" data-slide="9">
                <h1>üí° Community Mobilization</h1>
                <p>Mobilization means <strong>bringing people together</strong> to identify problems and take collective action.</p>
                
                <h2>Mobilization Strategies</h2>
                <ol>
                    <li><strong>Identify Champions:</strong> Find respected community members who can influence others</li>
                    <li><strong>Create Committees:</strong> Form groups around specific health issues</li>
                    <li><strong>Hold Regular Meetings:</strong> Keep the community engaged and informed</li>
                    <li><strong>Celebrate Successes:</strong> Recognize achievements to maintain momentum</li>
                    <li><strong>Use Local Media:</strong> Radio announcements, church bulletins, town criers</li>
                </ol>
                
                <div class="highlight-box">
                    <h3>Participatory Action</h3>
                    <p>The community should drive the solutions, not just receive instructions. Your role is to <strong>facilitate</strong>, not dictate.</p>
                </div>
            </div>

            <!-- Slide 10: Health Behaviors -->
            <div class="slide" data-slide="10">
                <h1>üíß Promoting Healthy Behaviors</h1>
                <p>Focus on the <strong>most impactful behaviors</strong> that prevent common diseases in your community.</p>
                
                <div class="card">
                    <h3>Priority Behaviors</h3>
                    <ul>
                        <li><strong>Handwashing:</strong> With soap at critical times (before eating, after toilet)</li>
                        <li><strong>Safe Water:</strong> Treating and storing water safely</li>
                        <li><strong>Sanitation:</strong> Using latrines and proper waste disposal</li>
                        <li><strong>Nutrition:</strong> Exclusive breastfeeding, diverse diets, food hygiene</li>
                        <li><strong>Immunization:</strong> Completing vaccination schedules for children</li>
                        <li><strong>Malaria Prevention:</strong> Sleeping under treated bed nets</li>
                        <li><strong>Early Treatment:</strong> Seeking care early when sick</li>
                    </ul>
                </div>
            </div>

            <!-- Slide 11: Disease Prevention -->
            <div class="slide" data-slide="11">
                <h1>ü¶† Disease Prevention Basics</h1>
                <p>Most diseases can be <strong>prevented</strong> through simple behaviors and environmental improvements.</p>
                
                <h2>Prevention Framework</h2>
                <div class="card">
                    <h3>Primary Prevention</h3>
                    <p>Stop disease before it starts: vaccination, health education, safe water</p>
                </div>
                
                <div class="card">
                    <h3>Secondary Prevention</h3>
                    <p>Detect disease early: screening, regular check-ups, prompt treatment</p>
                </div>
                
                <div class="card">
                    <h3>Tertiary Prevention</h3>
                    <p>Manage existing disease: adherence to treatment, rehabilitation, prevent complications</p>
                </div>
            </div>

            <!-- Slide 12: WASH -->
            <div class="slide" data-slide="12">
                <h1>üßº Water, Sanitation & Hygiene (WASH)</h1>
                <p>WASH interventions are among the <strong>most cost-effective</strong> ways to improve community health.</p>
                
                <h2>Key Messages</h2>
                <ul>
                    <li><strong>Safe Water:</strong> Boil, filter, or treat water before drinking</li>
                    <li><strong>Handwashing:</strong> Use soap and water at critical times daily</li>
                    <li><strong>Latrine Use:</strong> Use latrines consistently; keep them clean</li>
                    <li><strong>Food Safety:</strong> Wash hands before cooking; cook food thoroughly</li>
                    <li><strong>Waste Management:</strong> Dispose of garbage properly; compost organic waste</li>
                </ul>
                
                <div class="highlight-box">
                    <h3>WASH Impact</h3>
                    <p>Proper WASH practices can reduce diarrheal diseases by <strong>up to 40%</strong> and respiratory infections by <strong>up to 25%</strong>.</p>
                </div>
            </div>

            <!-- Slide 13: Ethics & Professionalism -->
            <div class="slide" data-slide="13">
                <h1>üëî Ethics and Professionalism</h1>
                <p>Your conduct as a CHA must be guided by <strong>ethical principles</strong> and professional standards.</p>
                
                <h2>Core Ethical Principles</h2>
                <div class="card">
                    <h3>‚öñÔ∏è Respect for Persons</h3>
                    <ul>
                        <li>Treat everyone with dignity regardless of background</li>
                        <li>Obtain informed consent before any procedure</li>
                        <li>Respect people's right to refuse services</li>
                    </ul>
                </div>
                
                <div class="card">
                    <h3>üôè Beneficence (Do Good)</h3>
                    <ul>
                        <li>Always act in the best interest of patients</li>
                        <li>Provide quality care to the best of your ability</li>
                        <li>Continue learning to improve your skills</li>
                    </ul>
                </div>
                
                <div class="card">
                    <h3>üîí Confidentiality</h3>
                    <ul>
                        <li>Keep patient information private</li>
                        <li>Only share information with those who need to know</li>
                        <li>Store records securely</li>
                    </ul>
                </div>
            </div>

            <!-- Slide 14: Challenges & Solutions -->
            <div class="slide" data-slide="14">
                <h1>Common Challenges and Solutions</h1>
                <p>Every CHA faces obstacles. The key is <strong>knowing how to respond</strong> professionally and creatively.</p>
                
                <h2>Challenge-Solution Matrix</h2>
                <div class="card">
                    <h3>Challenge: Community Resistance</h3>
                    <p><strong>Solution:</strong> Build trust slowly. Work with respected elders. Show results through pilot projects.</p>
                </div>
                
                <div class="card">
                    <h3>Challenge: Limited Resources</h3>
                    <p><strong>Solution:</strong> Partner with local organizations. Mobilize community resources. Advocate to authorities.</p>
                </div>
                
                <div class="card">
                    <h3>Challenge: Cultural Beliefs</h3>
                    <p><strong>Solution:</strong> Understand and respect beliefs. Find common ground. Work with traditional healers.</p>
                </div>
                
                <div class="card">
                    <h3>Challenge: Burnout & Stress</h3>
                    <p><strong>Solution:</strong> Build peer support networks. Practice self-care. Seek supervision when needed.</p>
                </div>
            </div>

            <!-- Slide 15: Conclusion -->
            <div class="slide" data-slide="15">
                <h1>üìù Module Summary</h1>
                <div class="highlight-box">
                    <h3>Key Takeaways</h3>
                    <ul>
                        <li>CHAs are vital bridges between health systems and communities</li>
                        <li>Trust and respect are the foundation of all community work</li>
                        <li>Effective communication requires cultural sensitivity and active listening</li>
                        <li>Community mobilization empowers people to solve their own health problems</li>
                        <li>Prevention is more effective and sustainable than treatment alone</li>
                        <li>Ethical practice and professionalism must guide all your actions</li>
                    </ul>
                </div>
                
                <h2>Next Steps</h2>
                <p>In Module 2, we will cover <strong>Maternal and Child Health</strong>, building on the community engagement skills you've learned here.</p>
                
                <div class="intro-section" style="padding: 40px 20px;">
                    <h1 style="font-size: 2em; margin-top: 30px;">Thank You! üéì</h1>
                    <p style="font-size: 1.2em;">Continue to Module 2 or review this module as needed.</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ============================================
        // GLOBAL VARIABLES
        // ============================================
        let currentSlide = 1;
        const totalSlides = 15;
        let isEditMode = false;

        // ============================================
        // INITIALIZATION
        // ============================================
        document.addEventListener('DOMContentLoaded', function() {
            updateNavigation();
            checkLibraries();
        });

        // Check if required libraries loaded successfully
        function checkLibraries() {
            const missing = [];
            if (typeof html2canvas === 'undefined') missing.push('html2canvas');
            if (typeof PptxGenJS === 'undefined') missing.push('PptxGenJS');
            if (typeof docx === 'undefined') missing.push('docx');
            if (typeof saveAs === 'undefined') missing.push('FileSaver');

            if (missing.length > 0) {
                showError(`Failed to load required libraries: ${missing.join(', ')}. Some export features may not work. Please check your internet connection and refresh the page.`);
            }
        }

        // ============================================
        // SLIDE NAVIGATION
        // ============================================
        function nextSlide() {
            if (currentSlide < totalSlides) {
                currentSlide++;
                showSlide(currentSlide);
            }
        }

        function previousSlide() {
            if (currentSlide > 1) {
                currentSlide--;
                showSlide(currentSlide);
            }
        }

        function showSlide(slideNumber) {
            const slides = document.querySelectorAll('.slide');
            slides.forEach(slide => slide.classList.remove('active'));
            
            const targetSlide = document.querySelector(`[data-slide="${slideNumber}"]`);
            if (targetSlide) {
                targetSlide.classList.add('active');
            }
            
            currentSlide = slideNumber;
            updateNavigation();
            
            // Scroll to top of slide viewer
            document.getElementById('slideViewer').scrollTop = 0;
        }

        function updateNavigation() {
            document.getElementById('currentSlide').textContent = currentSlide;
            document.getElementById('totalSlides').textContent = totalSlides;
            
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            
            prevBtn.disabled = (currentSlide === 1);
            nextBtn.disabled = (currentSlide === totalSlides);
        }

        // Keyboard navigation
        document.addEventListener('keydown', function(e) {
            if (e.key === 'ArrowRight') nextSlide();
            if (e.key === 'ArrowLeft') previousSlide();
        });

        // ============================================
        // EDIT MODE
        // ============================================
        function toggleEditMode() {
            isEditMode = !isEditMode;
            const btn = document.querySelector('.edit-mode-btn');
            const editableElements = document.querySelectorAll('.slide h1, .slide h2, .slide h3, .slide p, .slide li');
            
            if (isEditMode) {
                btn.classList.add('active');
                btn.textContent = 'üîí Lock Editing';
                editableElements.forEach(elem => {
                    elem.contentEditable = 'true';
                });
                showNotification('Edit mode enabled. Click text to edit.', 'success');
            } else {
                btn.classList.remove('active');
                btn.textContent = '‚úèÔ∏è Edit Mode';
                editableElements.forEach(elem => {
                    elem.contentEditable = 'false';
                });
                showNotification('Edit mode disabled. Changes saved.', 'success');
            }
        }

        // ============================================
        // PDF EXPORT
        // ============================================
        async function exportToPDF() {
            if (typeof html2canvas === 'undefined') {
                showError('PDF export requires html2canvas library. Please refresh the page and try again.');
                return;
            }

            try {
                showLoading('Generating PDF...');
                
                const { jsPDF } = window.jspdf;
                const pdf = new jsPDF('p', 'mm', 'a4');
                const slides = document.querySelectorAll('.slide');
                
                for (let i = 0; i < slides.length; i++) {
                    if (i > 0) pdf.addPage();
                    
                    const slide = slides[i];
                    slide.style.display = 'block';
                    
                    const canvas = await html2canvas(slide, {
                        scale: 2,
                        useCORS: true,
                        logging: false
                    });
                    
                    const imgData = canvas.toDataURL('image/png');
                    const imgWidth = 190;
                    const imgHeight = (canvas.height * imgWidth) / canvas.width;
                    
                    pdf.addImage(imgData, 'PNG', 10, 10, imgWidth, Math.min(imgHeight, 277));
                    
                    if (i !== currentSlide - 1) {
                        slide.style.display = 'none';
                    }
                    
                    updateLoading(`Processing slide ${i + 1} of ${slides.length}...`);
                    await sleep(100);
                }
                
                showSlide(currentSlide);
                pdf.save('CHA_Module1_Training.pdf');
                
                hideLoading();
                showNotification('PDF exported successfully!', 'success');
                
            } catch (error) {
                hideLoading();
                console.error('PDF export error:', error);
                showError('Error generating PDF: ' + error.message);
            }
        }

        // ============================================
        // POWERPOINT EXPORT
        // ============================================
        async function exportToPPT() {
            if (typeof PptxGenJS === 'undefined') {
                showError('PowerPoint export requires PptxGenJS library. Please refresh the page and try again.');
                return;
            }

            try {
                showLoading('Creating PowerPoint presentation...');
                
                const pptx = new PptxGenJS();
                pptx.layout = 'LAYOUT_WIDE';
                pptx.author = 'Ministry of Health, Liberia';
                pptx.title = 'CHA Module 1: Community Engagement and Empowerment';
                
                const slides = document.querySelectorAll('.slide');
                
                for (let i = 0; i < slides.length; i++) {
                    updateLoading(`Processing slide ${i + 1} of ${slides.length}...`);
                    await addSlideToPPT(pptx, slides[i], i + 1);
                    await sleep(100);
                }
                
                await pptx.writeFile({ fileName: 'CHA_Module1_Training.pptx' });
                
                hideLoading();
                showNotification('PowerPoint presentation created successfully!', 'success');
                
            } catch (error) {
                hideLoading();
                console.error('PPT export error:', error);
                showError('Error creating PowerPoint: ' + error.message);
            }
        }

        async function addSlideToPPT(pptx, slideElement, slideNumber) {
            const slide = pptx.addSlide();
            
            // Background
            slide.background = { color: 'FFFFFF' };
            
            // Title
            const title = slideElement.querySelector('h1, h2');
            if (title) {
                slide.addText(title.textContent.replace(/[üìöüè•‚≠êüö™üó∫Ô∏èüè†üö∂üìöüí°üíßü¶†üßºüëî‚öñÔ∏èüôèüîíüìù]/g, '').trim(), {
                    x: 0.5,
                    y: 0.5,
                    w: 9,
                    h: 1,
                    fontSize: 32,
                    bold: true,
                    color: 'C81E56',
                    align: 'center'
                });
            }
            
            // Content
            let yPos = 1.8;
            const contentElements = slideElement.querySelectorAll('p, ul, ol, .highlight-box, .card');
            
            for (const elem of contentElements) {
                if (yPos > 6.5) break;
                
                const text = elem.textContent.trim();
                if (!text || text.length < 3) continue;
                
                const isList = elem.tagName === 'UL' || elem.tagName === 'OL' || elem.closest('ul') || elem.closest('ol');
                const isHighlight = elem.classList.contains('highlight-box') || elem.classList.contains('card');
                
                slide.addText(text.substring(0, 500), {
                    x: 0.5,
                    y: yPos,
                    w: 9,
                    h: 'auto',
                    fontSize: 14,
                    color: '4A5568',
                    bullet: isList,
                    fill: isHighlight ? { color: 'F7FAFC' } : undefined
                });
                
                yPos += 0.6;
            }
            
            // Footer
            slide.addText(`Slide ${slideNumber}`, {
                x: 8.5,
                y: 7,
                w: 1,
                h: 0.3,
                fontSize: 10,
                color: '718096',
                align: 'right'
            });
        }

        // ============================================
        // WORD DOCUMENT EXPORT
        // ============================================
        async function exportToDOCX() {
            if (typeof docx === 'undefined' || typeof saveAs === 'undefined') {
                showError('Word export requires docx and FileSaver libraries. Please refresh the page and try again.');
                return;
            }

            try {
                showLoading('Creating Word document...');
                
                const { Document, Packer, Paragraph, TextRun, HeadingLevel, AlignmentType } = docx;
                
                const children = [];
                
                // Title page
                children.push(
                    new Paragraph({
                        text: 'National Community Health Program',
                        heading: HeadingLevel.HEADING_1,
                        alignment: AlignmentType.CENTER,
                        spacing: { after: 200 }
                    }),
                    new Paragraph({
                        text: 'MODULE ONE',
                        heading: HeadingLevel.HEADING_2,
                        alignment: AlignmentType.CENTER,
                        spacing: { after: 200 }
                    }),
                    new Paragraph({
                        text: 'Community Engagement and Empowerment',
                        heading: HeadingLevel.HEADING_2,
                        alignment: AlignmentType.CENTER,
                        spacing: { after: 400 }
                    }),
                    new Paragraph({
                        text: 'Community Health Assistant (CHA) Training',
                        alignment: AlignmentType.CENTER,
                        spacing: { after: 200 }
                    }),
                    new Paragraph({
                        text: 'Ministry of Health, Liberia',
                        alignment: AlignmentType.CENTER,
                        spacing: { after: 200 }
                    }),
                    new Paragraph({
                        text: '¬©2025',
                        alignment: AlignmentType.CENTER,
                        spacing: { after: 400 }
                    })
                );
                
                const slides = document.querySelectorAll('.slide');
                
                for (let i = 0; i < slides.length; i++) {
                    updateLoading(`Processing slide ${i + 1} of ${slides.length}...`);
                    await addSlideToDoc(children, slides[i], i + 1);
                    await sleep(50);
                }
                
                const doc = new Document({
                    sections: [{
                        properties: {},
                        children: children
                    }]
                });
                
                const blob = await Packer.toBlob(doc);
                saveAs(blob, 'CHA_Module1_Training.docx');
                
                hideLoading();
                showNotification('Word document created successfully!', 'success');
                
            } catch (error) {
                hideLoading();
                console.error('DOCX export error:', error);
                showError('Error creating Word document: ' + error.message);
            }
        }

        async function addSlideToDoc(children, slideElement, slideNumber) {
            const { Paragraph, TextRun, HeadingLevel, AlignmentType } = docx;
            
            if (slideNumber > 1) {
                children.push(new Paragraph({ text: '', pageBreakBefore: true }));
            }
            
            children.push(
                new Paragraph({
                    children: [
                        new TextRun({
                            text: `SLIDE ${slideNumber}`,
                            bold: true,
                            color: '718096',
                            size: 20
                        })
                    ],
                    spacing: { after: 200 }
                })
            );
            
            const title = slideElement.querySelector('h1, h2');
            if (title) {
                children.push(
                    new Paragraph({
                        text: title.textContent.replace(/[üìöüè•‚≠êüö™üó∫Ô∏èüè†üö∂üìöüí°üíßü¶†üßºüëî‚öñÔ∏èüôèüîíüìù]/g, '').trim(),
                        heading: HeadingLevel.HEADING_1,
                        spacing: { after: 200 }
                    })
                );
            }
            
            const paragraphs = slideElement.querySelectorAll('p');
            const lists = slideElement.querySelectorAll('ul, ol');
            
            paragraphs.forEach(p => {
                const text = p.textContent.trim();
                if (text && !p.closest('.highlight-box') && !p.closest('.card')) {
                    children.push(
                        new Paragraph({
                            text: text,
                            spacing: { after: 150 }
                        })
                    );
                }
            });
            
            lists.forEach(list => {
                const items = list.querySelectorAll('li');
                items.forEach(item => {
                    children.push(
                        new Paragraph({
                            text: '‚Ä¢ ' + item.textContent.trim(),
                            spacing: { after: 100 },
                            indent: { left: 720 }
                        })
                    );
                });
                children.push(new Paragraph({ text: '', spacing: { after: 150 } }));
            });
        }

        // ============================================
        // UI HELPER FUNCTIONS
        // ============================================
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type} show`;
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        function showError(message) {
            const errorDiv = document.getElementById('errorMessage');
            errorDiv.textContent = message;
            errorDiv.classList.add('show');
            
            setTimeout(() => {
                errorDiv.classList.remove('show');
            }, 8000);
        }

        function showLoading(message) {
            const overlay = document.getElementById('loadingOverlay');
            const text = document.getElementById('loadingText');
            text.textContent = message;
            overlay.classList.add('active');
        }

        function updateLoading(message) {
            const text = document.getElementById('loadingText');
            text.textContent = message;
        }

        function hideLoading() {
            const overlay = document.getElementById('loadingOverlay');
            overlay.classList.remove('active');
        }

        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        // ============================================
        // jsPDF CDN LOADER (for PDF export)
        // ============================================
        (function loadJsPDF() {
            const script = document.createElement('script');
            script.src = 'https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js';
            script.onload = () => console.log('jsPDF loaded successfully');
            script.onerror = () => console.error('Failed to load jsPDF');
            document.head.appendChild(script);
        })();
    </script>
</body>
</html>
